
name: "Build : Build 1"
env:
  GITHUB_TOKEN: ${{ secrets.EXTERNAL_GITHUB_TOKEN }}
on:
  push:
    branches:
    - 'main'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true
        default: sandbox
      test:
        description: 'Test input'
        required: false
        type: string

jobs:
  setup:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.generate-matrix.outputs.matrix }}
    steps:
      - name: Generate Matrix JSON
        id: generate-matrix
        run: |
          # Generate JSON matrix and save as output
          echo '{"include":[{"name":"Test1","value":"Value1"},{"name":"Test2","value":"Value2"}]}' > matrix.json
          MATRIX_JSON=$(cat matrix.json)
          echo "::set-output name=matrix::$MATRIX_JSON"
      
  consume-matrix:
    needs: [setup]
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(needs.setup.outputs.matrix) }}
    steps:
      - name: "Show Matrix Data ${{matrix.name}} with value: ${{matrix.value}}"
        run: |
          echo "Running job for name: ${{matrix.name}} with value: ${{matrix.value}}"
